# 任务2设计文档：用户加购后购买率统计

## 任务描述
统计每个用户的"加购后购买率"（Cart-to-Buy Conversion Rate），即用户加入购物车的商品中最终完成购买的比例。

## 数据格式
输入数据格式：(user_id, item_id, behavior, timestamp)
- user_id: 用户ID（整数）
- item_id: 商品ID（整数）
- behavior: 行为类型（"click", "cart", "buy"）
- timestamp: 时间戳（毫秒级整数）

## 设计思路

### 1. 数据预处理
- 过滤出所有cart和buy行为的数据
- 将数据映射为(user_id, item_id)为key，(behavior, timestamp)为value的格式

### 2. 计算逻辑
对于每个用户-商品组合：
- 检查是否存在cart行为且存在buy行为
- 确保buy行为的时间戳大于cart行为的时间戳
- 如果满足条件，则视为一次成功的"加购后购买"

### 3. 购买率计算
- 分子：用户有"加购→购买"路径的商品数
- 分母：用户加购过的不同商品总数
- 加购后购买率 = 分子 / 分母

### 4. RDD算子使用策略
- `filter()`: 筛选cart和buy行为
- `map()`: 转换数据格式
- `groupByKey()`: 按用户-商品分组
- `reduceByKey()`: 聚合统计
- `join()`: 连接加购和购买数据
- `fullOuterJoin()`: 确保所有用户都被统计

### 5. 输出格式
(user_id, cart_to_buy_rate)，保留2位小数，无加购行为的用户购买率为0.0

## 实现步骤
1. 读取输入数据
2. 分别过滤出cart和buy行为
3. 按用户-商品分组并检查购买条件
4. 计算每个用户的加购商品数和加购后购买商品数
5. 计算购买率并格式化输出

## 业务意义
这个指标是电商中非常重要的指标，用于衡量购物车流失情况，帮助分析用户购买决策过程。