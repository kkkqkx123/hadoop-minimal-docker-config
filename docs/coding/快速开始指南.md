# Hadoop Docker å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ ç¯å¢ƒéªŒè¯

é¦–å…ˆè¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ç¯å¢ƒæ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```bash
# è¿›å…¥WSLç¯å¢ƒ
cd /home/docker-compose/hadoop

# è¿è¡Œå®Œæ•´æµ‹è¯•
./test-scripts/test-custom-code.sh

# æˆ–è€…åªæµ‹è¯•ç‰¹å®šåŠŸèƒ½
./test-scripts/test-custom-code.sh --hdfs-only    # åªæµ‹è¯•HDFS
./test-scripts/test-custom-code.sh --python-only  # åªæµ‹è¯•Python Streaming
./test-scripts/test-custom-code.sh --java-only    # åªæµ‹è¯•Java MapReduce
```

## ğŸ“ æ‰§è¡Œè‡ªå®šä¹‰ä»£ç çš„3ç§æ–¹å¼

### æ–¹å¼1ï¼šJava MapReduceç¨‹åº

**æ­¥éª¤ï¼š**
1. ç¼–å†™Javaä»£ç ï¼ˆå‚è€ƒ `docs/coding/åœ¨hadoop-dockerä¸Šæ‰§è¡Œè‡ªå®šä¹‰ä»£ç æŒ‡å—.md`ï¼‰
2. ç¼–è¯‘æ‰“åŒ…æˆJARæ–‡ä»¶
3. å°†JARæ–‡ä»¶å¤åˆ¶åˆ°masterå®¹å™¨ï¼š`docker cp your-program.jar hadoop-master:/tmp/`
4. æ‰§è¡Œï¼š`docker-compose exec master hadoop jar /tmp/your-program.jar [å‚æ•°]`

**ç¤ºä¾‹ï¼š**
```bash
# ä½¿ç”¨å†…ç½®çš„PIè®¡ç®—ç¤ºä¾‹
docker-compose exec master hadoop jar /opt/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.6.jar pi 2 5
```

### æ–¹å¼2ï¼šPython MapReduceï¼ˆHadoop Streamingï¼‰

**æ­¥éª¤ï¼š**
1. åˆ›å»ºmapperå’Œreducer Pythonè„šæœ¬
2. å°†è„šæœ¬å¤åˆ¶åˆ°masterå®¹å™¨
3. å‡†å¤‡è¾“å…¥æ•°æ®å¹¶ä¸Šä¼ åˆ°HDFS
4. ä½¿ç”¨Hadoop Streamingæ‰§è¡Œ

**å¿«é€Ÿç¤ºä¾‹ï¼š**
```bash
# ç”Ÿæˆç¤ºä¾‹è„šæœ¬
cd /home/docker-compose/hadoop/examples/wordcount
python3 generate_wordcount.py

# å¤åˆ¶è„šæœ¬åˆ°å®¹å™¨
docker cp mapper.py hadoop-master:/tmp/
docker cp reducer.py hadoop-master:/tmp/

# åˆ›å»ºæµ‹è¯•æ•°æ®
echo "hello world hello hadoop python streaming is awesome" | docker-compose exec -T master tee /tmp/input.txt

# ä¸Šä¼ åˆ°HDFS
docker-compose exec master hdfs dfs -mkdir -p /wordcount/input
docker-compose exec master hdfs dfs -put /tmp/input.txt /wordcount/input/

# æ‰§è¡ŒMapReduce
docker-compose exec master hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-3.3.6.jar \
    -files /tmp/mapper.py,/tmp/reducer.py \
    -mapper 'python3 /tmp/mapper.py' \
    -reducer 'python3 /tmp/reducer.py' \
    -input /wordcount/input \
    -output /wordcount/output

# æŸ¥çœ‹ç»“æœ
docker-compose exec master hdfs dfs -cat /wordcount/output/part-*
```

### æ–¹å¼3ï¼šShellè„šæœ¬æ‰¹é‡å¤„ç†

**æ­¥éª¤ï¼š**
1. ç¼–å†™Shellè„šæœ¬å¤„ç†æ•°æ®
2. å°†è„šæœ¬å’Œæ•°æ®å¤åˆ¶åˆ°å®¹å™¨
3. ä½¿ç”¨HDFSå­˜å‚¨è¾“å…¥è¾“å‡º

**ç¤ºä¾‹ï¼š**
```bash
# åˆ›å»ºå¤„ç†è„šæœ¬
cat > /tmp/process.sh << 'EOF'
#!/bin/bash
while IFS= read -r line; do
    echo "Processed: $line" | wc -w
done
EOF

# å¤åˆ¶åˆ°å®¹å™¨å¹¶æ‰§è¡Œ
docker cp /tmp/process.sh hadoop-master:/tmp/
docker-compose exec master chmod +x /tmp/process.sh

# å¤„ç†æ•°æ®
docker-compose exec master hdfs dfs -cat /your/input/path/* | \
    docker-compose exec -T master /tmp/process.sh
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ä½œä¸šçŠ¶æ€
```bash
# æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ä½œä¸š
docker-compose exec master yarn application -list

# æŸ¥çœ‹ä½œä¸šè¯¦æƒ…
docker-compose exec master yarn application -status <application_id>

# æŸ¥çœ‹ä½œä¸šæ—¥å¿—
docker-compose exec master yarn logs -applicationId <application_id>
```

### æŸ¥çœ‹HDFSçŠ¶æ€
```bash
# æŸ¥çœ‹HDFSçŠ¶æ€
docker-compose exec master hdfs dfsadmin -report

# æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿ
docker-compose exec master hdfs dfs -ls /

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹
docker-compose exec master hdfs dfs -cat /path/to/file
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹ResourceManageræ—¥å¿—
docker-compose logs --tail=50 master | grep ResourceManager

# æŸ¥çœ‹NodeManageræ—¥å¿—
docker-compose logs --tail=50 worker1 | grep NodeManager
```

## âš¡ æ€§èƒ½è°ƒä¼˜å»ºè®®

### èµ„æºé…ç½®
- Mapä»»åŠ¡å†…å­˜ï¼š`mapreduce.map.memory.mb=512`
- Reduceä»»åŠ¡å†…å­˜ï¼š`mapreduce.reduce.memory.mb=512`
- JVMå †å¤§å°ï¼š`mapreduce.map.java.opts=-Xmx384m`

### å¹¶è¡Œåº¦è®¾ç½®
- Mapä»»åŠ¡æ•°ï¼š`mapreduce.job.maps=2`
- Reduceä»»åŠ¡æ•°ï¼š`mapreduce.job.reduces=1`

### æ•°æ®æœ¬åœ°åŒ–
- å°½é‡å°†è¾“å…¥æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨ä¸åŒèŠ‚ç‚¹
- ä½¿ç”¨é€‚å½“çš„å—å¤§å°ï¼ˆé»˜è®¤128MBï¼‰

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### 1. ä½œä¸šæ‰§è¡Œå¤±è´¥
- æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`docker-compose exec master jps`
- æ£€æŸ¥HDFSç©ºé—´ï¼š`docker-compose exec master hdfs dfs -df -h`
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š`docker-compose exec master yarn logs -applicationId <id>`

### 2. å†…å­˜ä¸è¶³
- å‡å°‘map/reduceä»»åŠ¡æ•°
- é™ä½å†…å­˜é…ç½®
- ä½¿ç”¨æ›´å°çš„æ•°æ®é›†æµ‹è¯•

### 3. æƒé™é—®é¢˜
- ç¡®ä¿HDFSç›®å½•å­˜åœ¨ï¼š`docker-compose exec master hdfs dfs -mkdir -p /user/root`
- æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š`docker-compose exec master hdfs dfs -ls /`

## ğŸ“š æ›´å¤šèµ„æº

- è¯¦ç»†æŒ‡å—ï¼š`docs/coding/åœ¨hadoop-dockerä¸Šæ‰§è¡Œè‡ªå®šä¹‰ä»£ç æŒ‡å—.md`
- æµ‹è¯•è„šæœ¬ï¼š`test-scripts/test-custom-code.sh`
- ç¤ºä¾‹ä»£ç ï¼š`examples/wordcount/`

## ğŸ¯ ä¸‹ä¸€æ­¥

1. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ç¯å¢ƒ
2. å°è¯•Python Streamingç¤ºä¾‹
3. ç¼–å†™è‡ªå·±çš„MapReduceç¨‹åº
4. æ¢ç´¢æ›´å¤šHadoopç”Ÿæ€å·¥å…·ï¼ˆHiveã€Pigç­‰ï¼‰