# Docker Hadoop é›†ç¾¤éƒ¨ç½²é¡¹ç›®

æœ¬é¡¹ç›®æä¾›äº†å¤šç§ä¼˜åŒ–é…ç½®çš„ Docker é•œåƒå’Œéƒ¨ç½²æ–¹æ¡ˆï¼Œç”¨äºå¿«é€Ÿæ­å»º Hadoop é›†ç¾¤ç¯å¢ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Docker 20.10+
- Docker Compose 1.29+
- è‡³å°‘ 8GB å¯ç”¨å†…å­˜
- 20GB å¯ç”¨ç£ç›˜ç©ºé—´

### 2. ä¸€é”®éƒ¨ç½²

```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /tmp/hadoop-volumes/{namenode,datanode1,datanode2,yarnlogs}

# æ„å»ºé•œåƒå¹¶å¯åŠ¨é›†ç¾¤
docker-compose up -d
```

### 3. éªŒè¯é›†ç¾¤çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# è®¿é—® Hadoop Web UI
# NameNode: http://localhost:9870
# ResourceManager: http://localhost:8088
# NodeManager: http://localhost:8042
```

## ğŸ“‹ éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | é•œåƒå¤§å° | å†…å­˜éœ€æ±‚ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| æ ‡å‡†ä¼˜åŒ–ç‰ˆ | ~600MB | 5GB | é€šç”¨åœºæ™¯ï¼Œå¹³è¡¡æ€§èƒ½å’Œèµ„æº |
| å¤šé˜¶æ®µæ„å»ºç‰ˆ | ~580MB | 5GB | ç”Ÿäº§ç¯å¢ƒï¼Œæœ€å°åŒ–é•œåƒå¤§å° |
| Alpine è½»é‡ç‰ˆ | ~400MB | 3.5GB | å¼€å‘æµ‹è¯•ï¼Œèµ„æºå—é™ç¯å¢ƒ |

## ğŸ”§ éƒ¨ç½²æ–¹æ¡ˆè¯¦æƒ…

### æ–¹æ¡ˆä¸€ï¼šæ ‡å‡†ä¼˜åŒ–ç‰ˆï¼ˆæ¨èï¼‰

```bash
# æ„å»ºé•œåƒ
docker build -t hadoop:optimized .

# å¯åŠ¨é›†ç¾¤
docker-compose up -d
```

**ç‰¹ç‚¹ï¼š**
- JVM å‚æ•°ä¼˜åŒ–ï¼ˆG1GCã€å †å†…å­˜è°ƒä¼˜ï¼‰
- ç½‘ç»œå‚æ•°ä¼˜åŒ–ï¼ˆTCPã€IPCï¼‰
- èµ„æºé™åˆ¶åˆç†åˆ†é…

### æ–¹æ¡ˆäºŒï¼šå¤šé˜¶æ®µæ„å»ºç‰ˆ

```bash
# æ„å»ºé•œåƒ
docker build -f Dockerfile.multistage -t hadoop:multistage .

# å¯åŠ¨é›†ç¾¤
docker-compose -f docker-compose-multistage.yml up -d
```

**ç‰¹ç‚¹ï¼š**
- æœ€å°åŒ–é•œåƒå¤§å°
- æ„å»ºè¿‡ç¨‹ä¼˜åŒ–
- ä¿æŒåŠŸèƒ½å®Œæ•´æ€§

### æ–¹æ¡ˆä¸‰ï¼šAlpine è½»é‡ç‰ˆ

```bash
# æ„å»ºé•œåƒ
docker build -f Dockerfile.alpine -t hadoop:alpine .

# å¯åŠ¨é›†ç¾¤
docker-compose -f docker-compose-alpine.yml up -d
```

**ç‰¹ç‚¹ï¼š**
- åŸºäº Alpine Linuxï¼Œé•œåƒæœ€å°
- å†…å­˜å ç”¨æœ€ä½
- é€‚åˆå¼€å‘æµ‹è¯•ç¯å¢ƒ

## ğŸ“Š é›†ç¾¤æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Hadoop Master â”‚    â”‚  Hadoop Worker1 â”‚    â”‚  Hadoop Worker2 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ NameNode  â”‚  â”‚    â”‚  â”‚ DataNode  â”‚  â”‚    â”‚  â”‚ DataNode  â”‚  â”‚
â”‚  â”‚           â”‚  â”‚    â”‚  â”‚           â”‚  â”‚    â”‚  â”‚           â”‚  â”‚
â”‚  â”‚ Resource- â”‚  â”‚    â”‚  â”‚ Node-     â”‚  â”‚    â”‚  â”‚ Node-     â”‚  â”‚
â”‚  â”‚ Manager   â”‚  â”‚    â”‚  â”‚ Manager   â”‚  â”‚    â”‚  â”‚ Manager   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  ç«¯å£:          â”‚    â”‚  ç«¯å£:          â”‚    â”‚  ç«¯å£:          â”‚
â”‚  9870 (NameNode)â”‚    â”‚  8042           â”‚    â”‚  8042           â”‚
â”‚  8088 (Resource)â”‚    â”‚  9864           â”‚    â”‚  9864           â”‚
â”‚  9000           â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ | ä¼˜åŒ–å†…å®¹ |
|------|------|----------|
| `conf/hadoop-env.sh` | Hadoopç¯å¢ƒé…ç½® | JVMå‚æ•°ã€å †å†…å­˜è®¾ç½® |
| `conf/core-site.xml` | æ ¸å¿ƒå‚æ•°é…ç½® | ç¼“å†²åŒºå¤§å°ã€ç½‘ç»œä¼˜åŒ– |
| `conf/hdfs-site.xml` | HDFSé…ç½® | å‰¯æœ¬å› å­ã€å—å¤§å° |
| `conf/yarn-site.xml` | YARNé…ç½® | å†…å­˜åˆ†é…ã€è°ƒåº¦å™¨è®¾ç½® |
| `conf/mapred-site.xml` | MapReduceé…ç½® | ä»»åŠ¡å†…å­˜é™åˆ¶ |

### Docker ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| `daemon.json` | Dockerå®ˆæŠ¤è¿›ç¨‹é…ç½® |
| `docker-compose*.yml` | é›†ç¾¤éƒ¨ç½²é…ç½® |
| `Dockerfile*` | é•œåƒæ„å»ºæ–‡ä»¶ |

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### JVM ä¼˜åŒ–
- ä½¿ç”¨ G1GC åƒåœ¾æ”¶é›†å™¨
- åˆç†çš„å †å†…å­˜åˆ†é…
- GC åœé¡¿æ—¶é—´ä¼˜åŒ–

### ç½‘ç»œä¼˜åŒ–
- TCP å‚æ•°è°ƒä¼˜
- IPC è¿æ¥ä¼˜åŒ–
- MTU å¤§å°è°ƒæ•´

### å­˜å‚¨ä¼˜åŒ–
- Overlay2 å­˜å‚¨é©±åŠ¨
- æ—¥å¿—å¤§å°é™åˆ¶
- æ•°æ®å·ç»‘å®šæŒ‚è½½

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs master
docker-compose logs worker1
```

### è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥ä¸»èŠ‚ç‚¹
docker-compose exec master bash

# è¿›å…¥å·¥ä½œèŠ‚ç‚¹
docker-compose exec worker1 bash
```

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹HDFSçŠ¶æ€
hdfs dfsadmin -report

# æŸ¥çœ‹YARNèŠ‚ç‚¹çŠ¶æ€
yarn node -list

# è¿è¡Œæµ‹è¯•ä½œä¸š
hadoop jar $HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-*.jar pi 2 5
```

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. å†…å­˜ä¸è¶³
- è°ƒæ•´ `docker-compose.yml` ä¸­çš„å†…å­˜é™åˆ¶
- ä½¿ç”¨ Alpine è½»é‡ç‰ˆå‡å°‘å†…å­˜å ç”¨

### 2. ç«¯å£å†²çª
- æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
- ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„

### 3. æ•°æ®ç›®å½•æƒé™
- ç¡®ä¿æ•°æ®ç›®å½•æœ‰æ­£ç¡®çš„æƒé™
- ä½¿ç”¨ `chmod` å‘½ä»¤è®¾ç½®æƒé™

## ğŸ¯ æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨å¤šé˜¶æ®µæ„å»ºç‰ˆï¼Œå¹³è¡¡æ€§èƒ½å’Œèµ„æº
2. **å¼€å‘æµ‹è¯•**ï¼šä½¿ç”¨ Alpine è½»é‡ç‰ˆï¼ŒèŠ‚çœèµ„æº
3. **å­¦ä¹ ç ”ç©¶**ï¼šä½¿ç”¨æ ‡å‡†ä¼˜åŒ–ç‰ˆï¼ŒåŠŸèƒ½å®Œæ•´
4. **èµ„æºç›‘æ§**ï¼šå®šæœŸæŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
5. **æ—¥å¿—ç®¡ç†**ï¼šåŠæ—¶æ¸…ç†è¿‡æœŸæ—¥å¿—æ–‡ä»¶

## ğŸ“š ç›¸å…³èµ„æº

- [Hadoop å®˜æ–¹æ–‡æ¡£](https://hadoop.apache.org/docs/)
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)

## ğŸ“– æ„å»ºåŸç†æ–‡æ¡£

è¯¦ç»†çš„æ„å»ºåŸç†å’ŒæŠ€æœ¯å®ç°è¯·å‚è€ƒ `docs/` ç›®å½•ï¼š

- **[æ ‡å‡†ä¼˜åŒ–ç‰ˆæ„å»ºåŸç†](docs/standard-build-principle.md)** - å•é˜¶æ®µæ„å»ºçš„å®Œæ•´æµç¨‹å’Œä¼˜åŒ–ç­–ç•¥
- **[å¤šé˜¶æ®µæ„å»ºç‰ˆåŸç†](docs/multistage-build-principle.md)** - Docker å¤šé˜¶æ®µæ„å»ºæŠ€æœ¯å’Œé•œåƒä¼˜åŒ–
- **[Alpine è½»é‡ç‰ˆæ„å»ºåŸç†](docs/alpine-build-principle.md)** - åŸºäº Alpine Linux çš„æè‡´è½»é‡åŒ–æ–¹æ¡ˆ
- **[Docker Compose éƒ¨ç½²åŸç†](docs/docker-compose-principle.md)** - å¤šå®¹å™¨ç¼–æ’å’ŒæœåŠ¡ç®¡ç†
- **[æ„å»ºæ–¹æ¡ˆå¯¹æ¯”æ€»ç»“](docs/build-comparison-summary.md)** - ä¸‰ç§æ–¹æ¡ˆçš„è¯¦ç»†å¯¹æ¯”åˆ†æ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶