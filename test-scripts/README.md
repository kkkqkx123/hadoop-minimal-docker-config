# Hadoop测试脚本使用指南

本目录包含用于测试Docker部署的Hadoop集群功能的各种脚本。

## 📋 脚本列表

### 1. `run-all-tests.sh` - 一键测试主脚本
**功能**: 提供菜单式界面，一键执行所有测试
**执行时间**: 5-60分钟（根据选择模式）
**用途**: 快速测试、完整测试套件、自动生成报告

### 2. `quick-test-hadoop.sh` - 快速测试脚本
**功能**: 一键快速验证Hadoop集群基本功能
**执行时间**: 2-5分钟
**用途**: 日常健康检查、部署后快速验证

### 3. `test-hdfs.sh` - HDFS功能测试脚本
**功能**: 详细测试HDFS文件系统功能
**执行时间**: 5-10分钟
**用途**: 验证HDFS各项功能、故障排查

### 4. `test-yarn.sh` - YARN功能测试脚本
**功能**: 详细测试YARN资源管理功能
**执行时间**: 5-10分钟
**用途**: 验证YARN作业调度、资源管理

### 5. `test-performance.sh` - 性能测试脚本
**功能**: 执行集群性能基准测试
**执行时间**: 15-30分钟
**用途**: 性能评估、容量规划

### 6. `check-cluster-health.sh` - 健康检查脚本
**功能**: 全面检查集群健康状态
**执行时间**: 3-8分钟
**用途**: 定期健康检查、问题诊断

## 🚀 快速开始

### 步骤1: 进入Master容器
```bash
docker exec -it master bash
```

### 步骤2: 导航到脚本目录
```bash
cd /opt/hadoop/docs/test/scripts
```

### 步骤3: 赋予脚本执行权限
```bash
chmod +x *.sh
```

### 步骤4: 运行测试

**推荐方式 - 使用一键测试脚本:**
```bash
./run-all-tests.sh
```

**快速测试:**
```bash
./quick-test-hadoop.sh
```

**完整测试:**
```bash
# 依次执行所有测试
./quick-test-hadoop.sh
./check-cluster-health.sh
./test-hdfs.sh
./test-yarn.sh
./test-performance.sh
```

## 📊 测试执行建议

### 新集群部署后
1. **快速测试** (`quick-test-hadoop.sh`) - 验证基本功能
2. **健康检查** (`check-cluster-health.sh`) - 确保所有组件正常
3. **HDFS测试** (`test-hdfs.sh`) - 验证文件系统功能

### 日常维护
- **每日**: 快速测试脚本
- **每周**: 健康检查脚本
- **每月**: 性能测试脚本

### 故障排查
1. **健康检查** - 识别问题组件
2. **HDFS测试** - 如果是存储问题
3. **YARN测试** - 如果是计算问题
4. **性能测试** - 如果是性能问题

## 🔍 测试结果解读

### 输出颜色说明
- ✅ **绿色**: 测试通过，功能正常
- ❌ **红色**: 测试失败，需要关注
- ⚠️ **黄色**: 测试警告，建议检查
- ℹ️ **蓝色**: 信息输出，供参考

### 常见结果状态

| 状态 | 含义 | 建议操作 |
|------|------|----------|
| 全部通过 | 集群运行正常 | 无需操作 |
| 部分警告 | 功能可用但有优化空间 | 查看警告详情 |
| 部分失败 | 某些功能异常 | 查看失败原因并修复 |
| 全部失败 | 集群严重问题 | 立即停止并排查问题 |

## 🛠️ 故障排查

### 脚本执行失败
1. **检查容器状态**
   ```bash
   docker-compose ps
   ```

2. **检查权限**
   ```bash
   ls -la *.sh
   chmod +x *.sh
   ```

3. **检查环境变量**
   ```bash
   echo $HADOOP_HOME
   echo $JAVA_HOME
   ```

4. **查看详细日志**
   ```bash
   tail -f $HADOOP_HOME/logs/*.log
   ```

### 测试失败处理
1. **记录失败信息**
2. **查看相关日志**
3. **检查配置文件**
4. **验证网络连接**
5. **检查资源使用情况**

## 📈 性能基准参考

### 小型集群（2-3节点）
- **HDFS写吞吐量**: 50-200 MB/sec
- **HDFS读吞吐量**: 100-300 MB/sec
- **TeraSort (100万条)**: 30-120秒
- **WordCount (10个文件)**: 15-60秒

### 注意事项
- 性能会因硬件配置而异
- 网络带宽影响测试结果
- 宿主机资源限制影响性能
- 并行测试可能影响结果

## 🔧 高级用法

### 自定义测试参数
可以修改脚本中的参数来适应不同的测试需求：

```bash
# 修改文件大小
-fileSize 500MB  # 改为500MB

# 修改文件数量
-nrFiles 20      # 改为20个文件

# 修改测试数据量
teragen 5000000  # 改为500万条记录
```

### 定时执行
可以设置定时任务来自动执行测试：

```bash
# 编辑crontab
crontab -e

# 添加定时任务（每天凌晨2点执行健康检查）
0 2 * * * /path/to/check-cluster-health.sh >> /var/log/hadoop-health.log 2>&1
```

### 结果记录
建议记录测试结果以便趋势分析：

```bash
# 创建结果目录
mkdir -p /tmp/hadoop-test-results

# 执行测试并保存结果
./test-performance.sh > /tmp/hadoop-test-results/performance-$(date +%Y%m%d-%H%M%S).log
```

## 📞 技术支持

### 常见问题
1. **Q**: 脚本执行权限问题
   **A**: 确保使用 `chmod +x scriptname.sh` 赋予执行权限

2. **Q**: 容器内找不到脚本
   **A**: 确认脚本已复制到容器内，路径正确

3. **Q**: 测试超时或卡住
   **A**: 检查资源使用情况，可能需要调整测试参数

4. **Q**: 性能测试结果不稳定
   **A**: 确保测试时无其他负载，多次测试取平均值

### 获取帮助
- 查看详细日志信息
- 检查Hadoop官方文档
- 在社区论坛寻求帮助

## ⚠️ 注意事项

1. **资源需求**: 确保宿主机有足够的CPU和内存
2. **网络配置**: 确保Docker网络配置正确
3. **数据清理**: 测试完成后及时清理测试数据
4. **日志管理**: 定期清理日志文件避免磁盘空间不足
5. **版本兼容性**: 确保脚本与Hadoop版本兼容

---

**祝测试顺利！** 🎉

通过系统化的测试，您可以确保Hadoop集群稳定可靠地运行。